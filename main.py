import argparse
from parse import PackageParser, ProjectType
from prettytable import PrettyTable

argument_parser = argparse.ArgumentParser()

dependencies_file = argument_parser.add_mutually_exclusive_group(required=True)
dependencies_file.add_argument("-r", help="The requirements.txt file of a Python project")
dependencies_file.add_argument("-p", help="The package.json file of an npm project")

args = argument_parser.parse_args()
dependencies_file_path = None
PROJECT_TYPE = None

if args.r:
    dependencies_file_path = args.r
    PROJECT_TYPE = ProjectType.PYTHON
else:
    dependencies_file_path = args.p
    PROJECT_TYPE = ProjectType.NPM

package_parser = PackageParser(PROJECT_TYPE)

results_table = PrettyTable(["Dependency Name", "Current Dependency Version", "CVE ID", "Fixed Version"])
results_table.hrules = 1 # add horizontal separators between table rows

for result in package_parser.scan(dependencies_file_path):
    results_table.add_row(result)

if len(results_table.rows) > 0:
    print(results_table)
